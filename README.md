Онлайн-сервис чтения манги с покупкой глав

Веб-сервис, где пользователи могут:

    - Искать и просматривать мангу.

    - Читать бесплатные главы или покупать платные.

    - После покупки глава остаётся доступна навсегда.

    - Добавлять мангу в избранное.

    - Смотреть обложки, альтернативные названия и прочие данные из метаинформации.

Пользовательская логика
    Гость: 
        - может просматривать каталог и читать бесплатные главы.

    Авторизованный пользователь:

        - Покупает отдельные главы.

        - Получает доступ к уже купленным главам.

        - Ведёт свою коллекцию (избранное, история покупок).
    Админ:
        - загрузка глав
        - создание манги
        - удаление коментов

Механика покупки
    - У каждой главы есть флаг: is_premium = True/False.

    - Если глава бесплатная — доступна всем.

    - Если платная:

        - Пользователь должен купить эту главу (и она навсегда в его доступе).

        - Цена может быть фиксированной (например, 10 монет).


Модель данных:
Манга:
    main_name:str, secondary_name:str, issue_year:int, rating:float, views:int, count_bookmarks:int.
    comments: list, chapters: list, cover_url: str

Комментарии
    manga_id:fk, user_id:fk, content:str, created_at:datetime

Главы:
    manga_id:fk, number:int, title:str, is_premium:bool, pages:list, created_at:datetime.

Страница:
    chapter_id:fk, img_url:str, page_number:int.

Пользователь:
    username:str, email:str, purchases:list, favorite_manga:m-t-m, coins:int, is_superuser

Таблица Избранного:
    user_id:fk, manga_id:fk, created_at:datetime

Таблица покупок глав:
    user_id:fk, chapter_id:fk, purchased_at:datetime, price:int

Загрузка новых глав:
    Загрузка архива: .zip или .cbz файла с изображениями.
    Фоновая задача: через Celery распаковываем и добавляем страницы.
    Сохранение: номер главы, премиум-флаг и т.д.
    Храним изображения: локально(media/{manga_id}/chapters/{chapter_id}/001.jpg) и сохраняем URL'ы в Page.

Папка внутри .zip:
    chapter_42.zip
    ├── 001.jpg
    ├── 002.jpg
    ├── 003.jpg



План:
1 Пишем модели манги, глав, страниц и связи между ними
делаем миграции
репозитории, Сервисы, ручки

2 Загрузка новых глав
ручки
дабавляем Celery(добавление глав и уведомление о появлении новых глав если в избранном)

3 Пользователи и авторизация
репозитории, Сервисы, ручки

4 Покупки глав
репозитории, Сервисы, ручки

5 Избранное, комментарии
репозитории, Сервисы, ручки

6 История покупок
ручки, проверка доступа 

7 Настройка docker compose и деплой

8 Тесты и документация

Опционально:
9 HTMX + UI


Вопросы:
как лучше считать количество просмотров?
(
Что пришло в голову:
    - в redis трекать данные при каждом просмотре пользователя и добавлять ключ если его нет а потом через celery обновлять данные для манги по расписанию
    - так же трекать в redis и если нет ключа то сразу обновлять данные в манге
)